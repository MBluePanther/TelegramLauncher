<mah:MetroWindow x:Class="TelegramLauncher.Views.SorterWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
                 xmlns:models="clr-namespace:TelegramLauncher.Models"
                 Title="Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ñ‰Ð¸Ðº"
                 Width="1100"
                 Height="680"
                 WindowStartupLocation="CenterOwner"
                 ResizeMode="CanResizeWithGrip">

    <!-- Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ñ€ÐµÑÑƒÑ€ÑÑ‹ -->
    <mah:MetroWindow.Resources>

        <!-- ÐšÐ¸ÑÑ‚Ð¸ ÑÑ‚Ð°Ñ‚ÑƒÑÐ¾Ð² -->
        <SolidColorBrush x:Key="StatusBrushActive" Color="#4CAF50"/>
        <SolidColorBrush x:Key="StatusBrushFrozen" Color="#FFC107"/>
        <SolidColorBrush x:Key="StatusBrushCrash"  Color="#F44336"/>
        <SolidColorBrush x:Key="StatusBrushNeutral" Color="#808080"/>

        <!-- ÐŸÑ€Ð¸Ð·Ñ€Ð°Ñ‡Ð½Ð°Ñ ÐºÐ½Ð¾Ð¿ÐºÐ° -->
        <Style x:Key="GhostButton"
               TargetType="Button"
               BasedOn="{StaticResource MahApps.Styles.Button.Flat}">
            <Setter Property="Background"      Value="Transparent"/>
            <Setter Property="BorderBrush"     Value="{DynamicResource MahApps.Brushes.Control.Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding"         Value="12,6"/>
            <Setter Property="mah:ControlsHelper.CornerRadius" Value="8"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
        </Style>

        <!-- ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ ÐºÐ½Ð¾Ð¿ÐºÐ° -->
        <Style x:Key="PrimaryButton"
               TargetType="Button"
               BasedOn="{StaticResource MahApps.Styles.Button}">
            <Setter Property="Foreground"      Value="{DynamicResource MahApps.Brushes.IdealForeground}"/>
            <Setter Property="Background"      Value="{DynamicResource MahApps.Brushes.Accent}"/>
            <Setter Property="BorderBrush"     Value="{DynamicResource MahApps.Brushes.Accent2}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding"         Value="12,6"/>
            <Setter Property="mah:ControlsHelper.CornerRadius" Value="8"/>
        </Style>

        <!-- Ð¨Ð°Ð±Ð»Ð¾Ð½ ÑÑ‡ÐµÐ¹ÐºÐ¸ ÑÑ‚Ð°Ñ‚ÑƒÑÐ°: ÐºÑ€ÑƒÐ¶Ð¾Ðº + Ð¸ÐºÐ¾Ð½ÐºÐ° + Ñ‚ÐµÐºÑÑ‚ -->
        <DataTemplate x:Key="StatusCellTemplate">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <Ellipse x:Name="Dot" Width="10" Height="10" Fill="{StaticResource StatusBrushNeutral}"/>
                <TextBlock x:Name="Icon" Text="âšª" Margin="6,0,0,0" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding Status}" Margin="6,0,0,0" Opacity="0.7"/>
            </StackPanel>
            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding Status}" Value="{x:Static models:ClientStatus.Active}">
                    <Setter TargetName="Dot"  Property="Shape.Fill"      Value="{StaticResource StatusBrushActive}"/>
                    <Setter TargetName="Icon" Property="TextBlock.Text"  Value="ðŸŸ¢"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="{x:Static models:ClientStatus.Frozen}">
                    <Setter TargetName="Dot"  Property="Shape.Fill"      Value="{StaticResource StatusBrushFrozen}"/>
                    <Setter TargetName="Icon" Property="TextBlock.Text"  Value="ðŸŸ¡"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="{x:Static models:ClientStatus.Crash}">
                    <Setter TargetName="Dot"  Property="Shape.Fill"      Value="{StaticResource StatusBrushCrash}"/>
                    <Setter TargetName="Icon" Property="TextBlock.Text"  Value="ðŸ”´"/>
                </DataTrigger>
            </DataTemplate.Triggers>
        </DataTemplate>

    </mah:MetroWindow.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº/Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ -->
        <StackPanel Orientation="Vertical" Margin="0,0,0,12">
            <TextBlock Text="Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ñ‰Ð¸Ðº ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²" FontSize="20" FontWeight="SemiBold"/>
            <TextBlock Text="ÐžÑ‚Ð¼ÐµÑ‚ÑŒ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð² Ñ‡ÐµÐºÐ±Ð¾ÐºÑÐ°Ð¼Ð¸, Ð²Ñ‹Ð±ÐµÑ€Ð¸ Ð¿Ð°Ð¿ÐºÑƒ Ð¸ Ð½Ð°Ð¶Ð¼Ð¸ Â«ÐžÑ‚ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÂ»."
                       Opacity="0.7" Margin="0,4,0,0"/>
        </StackPanel>

        <!-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° -->
        <DataGrid x:Name="ClientsGrid"
                  Grid.Row="1"
                  ItemsSource="{Binding Clients}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  SelectionMode="Extended"
                  HeadersVisibility="Column"
                  IsReadOnly="False">

            <DataGrid.Columns>
                <!-- Ð’Ñ‹Ð±Ð¾Ñ€ -->
                <DataGridCheckBoxColumn Header="âœ“" Binding="{Binding IsSelected, Mode=TwoWay}" Width="40"/>

                <!-- ÐšÐ»Ð¸ÐµÐ½Ñ‚ -->
                <DataGridTextColumn Header="ÐšÐ›Ð˜Ð•ÐÐ¢" Binding="{Binding Name}" Width="*" />

                <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: Ñ†Ð²ÐµÑ‚ + Ð¸ÐºÐ¾Ð½ÐºÐ° + Ñ‚ÐµÐºÑÑ‚ -->
                <DataGridTemplateColumn Header="Ð¡Ð¢ÐÐ¢Ð£Ð¡" Width="180" CellTemplate="{StaticResource StatusCellTemplate}"/>

                <!-- ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð·Ð°Ð¿ÑƒÑÐº -->
                <DataGridTextColumn Header="ÐŸÐžÐ¡Ð›Ð•Ð”ÐÐ˜Ð™ Ð—ÐÐŸÐ£Ð¡Ðš"
                                    Binding="{Binding LastOpenedUtc, StringFormat={}{0:dd.MM.yyyy HH:mm}, TargetNullValue=â€”}"
                                    Width="170"/>

                <!-- ÐŸÐ°Ð¿ÐºÐ° -->
                <DataGridTextColumn Header="ÐŸÐÐŸÐšÐ" Binding="{Binding ExePath}" Width="300"/>

                <!-- TDATA Ð¿Ñ€Ð¸ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ (Ñ‡ÐµÐºÐ±Ð¾ÐºÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ) -->
                <DataGridCheckBoxColumn Header="TDATA"
                                        Binding="{Binding TDataExists, Mode=OneWay}"
                                        IsReadOnly="True"
                                        Width="80"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- ÐÐ¸Ð¶Ð½ÑÑ Ð¿Ð°Ð½ÐµÐ»ÑŒ -->
        <Grid Grid.Row="2" Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Grid.Column="0">
                <TextBlock Text="ÐŸÐ°Ð¿ÐºÐ° Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                <TextBox Width="380" Margin="0,0,8,0"
                         Text="{Binding DestinationFolder, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                <Button Content="ÐžÐ±Ð·Ð¾Ñ€" Style="{StaticResource GhostButton}"
                        Command="{Binding BrowseDestinationCommand}"/>
            </StackPanel>

            <Button Grid.Column="1" Margin="8,0,0,0"
                    Style="{StaticResource PrimaryButton}"
                    Content="ÐžÑ‚ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"
                    IsEnabled="{Binding CanSort}"
                    Command="{Binding SortCommand}"/>

            <Button Grid.Column="2" Margin="8,0,0,0"
                    Style="{StaticResource GhostButton}"
                    Content="ÐžÑ‚ÐºÐ°Ñ‚"
                    IsEnabled="{Binding CanUndo}"
                    Command="{Binding UndoCommand}"/>
        </Grid>
    </Grid>
</mah:MetroWindow>
